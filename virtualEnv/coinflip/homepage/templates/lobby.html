{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Coinflip - Game List</title>
    <link rel="stylesheet" type="text/css" href="{% static 'starterCSS.css' %}">
</head>
<body>
    <img src="{% static 'images/coin.png' %}" alt="Coinflip Image" class="top-image">
    <h1 id="heading">Coinflip - Game List</h1>
    
    {% if user.is_authenticated %}
        <p>Welcome, {{ user.username }}!</p>
        <p id="balance">Balance: {{ user.userprofile.currency }}</p>
        <p>Wins: {{ user.userprofile.wins }}</p>
        <p>Losses: {{ user.userprofile.loses }}</p>
        <button onclick="window.location.href='/create_game'">Create New Game</button><br><br>
        
        <h2>Game List</h2>
        <ul id="game-list" class="game-list">
            {% for game in games %}
                <li style="color: #FFF;">
                    Game ID: {{ game.id }}<br>
                    Player: {{ game.player1.user_profile.user.username }}<br>
                    Side: {{ game.player1.side }}<br>
                    Bet: {{ game.bet }}<br>
                    <button onclick="window.location.href='/play_game/{{ game.id }}/'">Play</button>
                </li>
            {% endfor %}
        </ul>
        
        <button onclick="window.location.href='/'">Back to Homepage</button><br><br>
    {% else %}
        <p>Please login to access the game list.</p>
        <button onclick="window.location.href='/login'">Login</button><br><br>
    {% endif %}
    
    <script src="{% static 'javascript/starter.js' %}"></script>
    
    <script>
        const socket = new WebSocket('ws://' + window.location.host + '/ws/game-list/');
        
        socket.onopen = function(event) {
            console.log('WebSocket connection established');
        };
        
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            
            // Update the game list
            const gameList = document.getElementById('game-list');
            gameList.innerHTML = '';
            data.game_list.forEach(function(game) {
                const li = document.createElement('li');
                li.style.color = '#FFF';
                li.innerHTML = `
                    Game ID: ${game.id}<br>
                    Player: ${game.player1.user_profile.user.username}<br>
                    Side: ${game.player1.side}<br>
                    Bet: ${game.bet}<br>
                    <button onclick="window.location.href='/play_game/${game.id}/'">Play</button>
                `;
                gameList.appendChild(li);
            });
            
            // Update the balance
            const balanceElement = document.getElementById('balance');
            balanceElement.textContent = `Balance: ${data.balance}`;
        };
        
        socket.onclose = function(event) {
            console.log('WebSocket connection closed');
        };
    </script>
</body>
</html>